<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Professional Profile - FundiPluss</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="../index.html">
                <i class="bi bi-tools"></i> FundiPluss
            </a>
        </div>
    </nav>

    <div class="container">
        <div class="form-container" style="max-width: 600px;">
            <h2 class="form-title">Complete Professional Profile</h2>
            
            <div class="alert alert-info">
                <i class="bi bi-info-circle"></i> 
                Complete your profile to start receiving job requests. You'll need admin approval after submission.
            </div>
            
            <form id="professionalForm" onsubmit="handleProfessionalRegistration(event)">
                <div class="mb-3">
                    <label for="trade" class="form-label">Your Trade *</label>
                    <select class="form-select" id="trade" required>
                        <option value="">Select your trade</option>
                        <option value="plumber">Plumber</option>
                        <option value="electrician">Electrician</option>
                        <option value="mechanic">Mechanic</option>
                        <option value="phone_repair">Phone Repair</option>
                        <option value="carpenter">Carpenter</option>
                        <option value="painter">Painter</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label for="experience" class="form-label">Years of Experience *</label>
                    <input type="number" class="form-control" id="experience" min="0" max="50" required>
                </div>
                
                <div class="mb-3">
                    <label for="hourlyRate" class="form-label">Hourly Rate (KES) *</label>
                    <input type="number" class="form-control" id="hourlyRate" min="0" required>
                </div>
                
                <div class="mb-3">
                    <label for="location" class="form-label">Service Location *</label>
                    <input type="text" class="form-control" id="location" placeholder="e.g., Nairobi, Mombasa" required>
                </div>
                
                <div class="mb-3">
                    <label for="bio" class="form-label">Bio / Description *</label>
                    <textarea class="form-control" id="bio" rows="4" placeholder="Tell customers about yourself, your skills, and experience" required></textarea>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Upload Documents (Certificates, IDs, etc.)</label>
                    <div class="file-upload" onclick="document.getElementById('documents').click()">
                        <i class="bi bi-cloud-upload fs-1"></i>
                        <p id="fileCount">Click to upload documents (optional)</p>
                    </div>
                    <input type="file" class="d-none" id="documents" name="documents" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" onchange="updateFileCount()">
                    <small class="text-muted">Upload any relevant certificates or identification (PDF, images, docs)</small>
                </div>
                
                <button type="submit" class="btn btn-primary w-100 mb-3">Submit for Approval</button>
                
                <div class="text-center">
                    <a href="professional-dashboard.html">I'll do this later</a>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/main.js"></script>
    <script>
        function updateFileCount() {
            const files = document.getElementById('documents').files;
            const count = files.length;
            document.getElementById('fileCount').innerHTML = 
                count > 0 ? `${count} file(s) selected` : 'Click to upload documents (optional)';
        }
        
        async function handleProfessionalRegistration(event) {
            event.preventDefault();
            
            const formData = new FormData();
            formData.append('trade', document.getElementById('trade').value);
            formData.append('experience', document.getElementById('experience').value);
            formData.append('hourlyRate', document.getElementById('hourlyRate').value);
            formData.append('location', document.getElementById('location').value);
            formData.append('bio', document.getElementById('bio').value);
            
            const files = document.getElementById('documents').files;
            for (let i = 0; i < files.length; i++) {
                formData.append('documents', files[i]);
            }
            
            try {
                showLoading();
                const result = await fetch(`${API_URL}/professionals/register`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: formData
                });
                
                const data = await result.json();
                
                if (!result.ok) {
                    throw new Error(data.message || 'Registration failed');
                }
                
                hideLoading();
                showAlert('Professional profile submitted for approval!', 'success');
                
                // Update user role in localStorage
                const user = JSON.parse(localStorage.getItem('user'));
                user.role = 'professional';
                localStorage.setItem('user', JSON.stringify(user));
                
                // Redirect to dashboard after 2 seconds
                setTimeout(() => {
                    window.location.href = 'professional-dashboard.html';
                }, 2000);
                
            } catch (error) {
                hideLoading();
                showAlert(error.message, 'danger');
            }
        }
    </script>
</body>
</html>